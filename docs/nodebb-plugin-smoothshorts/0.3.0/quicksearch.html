<html>
<head>
</head>
<body style="background: transparent;">
    <script src="scripts/docstrap.lib.js"></script>
    <script src="scripts/lunr.min.js"></script>
    <script src="scripts/fulltext-search.js"></script>

    <script type="text/x-docstrap-searchdb">
    {"virtual_namespaces.js.html":{"id":"virtual_namespaces.js.html","title":"Source: virtual_namespaces.js","body":" Documentation Namespaces acpacp.controllerbackendclientclient.controllernodebb-core Modules backend.hashingbackend.SmoothShortsclient.contextmenuclient.helperclient.settingsclient.sockets Classes client.HashedPostclient.HashedTopic Events nodebb-core.event:&quot;action:post.purge&quot;nodebb-core.event:&quot;action:post.save&quot;nodebb-core.event:&quot;action:topic.purge&quot;nodebb-core.event:&quot;action:topic.save&quot;nodebb-core.event:&quot;filter:admin.header.build&quot;nodebb-core.event:&quot;static:app.load&quot; Source: virtual_namespaces.js /** * Backend scripts * @namespace backend */ /** * Frontend ACP scripts * @namespace acp */ /** * Frontend client scripts * @namespace client */ /** * NodeBB core parts, used in the plugin * @namespace nodebb-core */ × Search results Close Documentation generated by JSDoc 3.4.0 on 2016-04-22T06:55:56+02:00 using the DocStrap template. "},"public_static_scripts_controller.js.html":{"id":"public_static_scripts_controller.js.html","title":"Source: public/static/scripts/controller.js","body":" Documentation Namespaces acpacp.controllerbackendclientclient.controllernodebb-core Modules backend.hashingbackend.SmoothShortsclient.contextmenuclient.helperclient.settingsclient.sockets Classes client.HashedPostclient.HashedTopic Events nodebb-core.event:&quot;action:post.purge&quot;nodebb-core.event:&quot;action:post.save&quot;nodebb-core.event:&quot;action:topic.purge&quot;nodebb-core.event:&quot;action:topic.save&quot;nodebb-core.event:&quot;filter:admin.header.build&quot;nodebb-core.event:&quot;static:app.load&quot; Source: public/static/scripts/controller.js /* global app, socket */ $(document).ready(function() { 'use strict'; /** * @namespace controller * @memberOf acp */ /** * Checkbox Element, indicating whether to use set [modifier key]{@link acp.controller.ddModKey} * @memberOf acp.controller * @type {HTMLInputElement} */ var useModKey = document.getElementById('useModKey'); /** * Dropdown selection Element to set (possible) modifier key * @see acp.controller.useModKey * @memberOf acp.controller * @type {HTMLSelectElement} */ var ddModKey = document.getElementById('modKey'); /** * Text input Element to define short URL format * @memberOf acp.controller * @type {HTMLInputElement} */ var shortFormat = document.getElementById('shortFormat'); /** * JQuery instance of [shortFormat]{@link acp.controller.shortFormat} * @memberOf acp.controller * @type {jQuery} */ var $shortFormat = $(shortFormat); /** * Button to select icon for copy button * @memberOf acp.controller * @type {HTMLButtonElement} */ var copyButtonIcon = document.getElementById('copyButtonIcon'); /** * Button to trigger hashing of unhashed posts/topics * @memberOf acp.controller * @type {HTMLButtonElement} */ var btnHash = document.getElementById('btnHash'); /** * Button to save settings * @memberOf acp.controller * @type {HTMLButtonElement} */ var btnSave = document.getElementById('btnSave'); /** * Holds Elements for 'status' (i.e. # of hashed/unhased topics and posts) * @memberOf acp.controller * @type {Object} * @property {HTMLDivElement} topicTotal - Shows total # of topics * @property {HTMLDivElement} topic - Shows # of hashed topics * @property {HTMLDivElement} topicWell - Wraps topicTotal and topic; indicates missing hashes with red border-left/right * @property {HTMLDivElement} postTotal - Shows total # of posts * @property {HTMLDivElement} post - Shows # of hashed posts * @property {HTMLDivElement} postWell - Wraps postsTotal and post; indicates missing hashes with red border-left/right */ var counter = { topicTotal: document.getElementById('topicCount'), topic: document.getElementById('topicHashCount'), topicWell: document.getElementById('topicWell'), postTotal: document.getElementById('postCount'), post: document.getElementById('postHashCount'), postWell: document.getElementById('postWell') }; /** * Disables/Enables [ddModKey]{@link acp.controller.ddModKey} * @memberOf acp.controller * @inner * @method handleUseModKey * @param {MouseEvent} event */ useModKey.addEventListener('click', function handleUseModKey(event) { ddModKey.disabled = !event.target.checked; }); /** * Saves settings * @memberOf acp.controller * @inner * @method saveSettings * @param {MouseEvent} event */ btnSave.addEventListener('click', function(event) { event.preventDefault(); if (!validateShortFormat()) { return app.alertError('Please define the position of post/topic hash with :hash !'); } socket.emit('admin.plugins.SmoothShorts.saveSettings', { useModKey: useModKey.checked, modKey: ddModKey.selectedOptions.item(0).value.toLowerCase(), shortFormat: shortFormat.value, copyButtonClass: copyButtonIcon.firstElementChild.value }, function(err) { if (err) { app.alertError('Couldn\\'t save settings.'); return console.error(err); } var alertOptions = { title: 'Settings saved', message: 'Please restart your NodeBB to apply the new settings!', clickfn: function() { require(['admin/modules/instance'], function(instance) { instance.reload(); }); } }; app.alert(alertOptions); }); }); /** * Starts hashing unhashed topics/posts * @memberOf acp.controller * @inner * @method hashMissing */ btnHash.addEventListener('click', function() { socket.emit('admin.plugins.SmoothShorts.hashMissing', function(err) { if (err) { return app.alertError(err.message); } }); }); /** * Checks whether acp.[controller]{@link acp.controller.shortFormat} * includes the `:hash` keyword * @inner * @return {bool} */ function validateShortFormat() { return shortFormat.value.length === 0 || shortFormat.value.indexOf(':hash') !== -1; } /** * Updates acp.controller.counter Elements on newhash-message * from backend * @memberOf acp.controller * @inner * @param {Object} data */ function handleNewHash(data) { var target = counter[data.type]; var total = counter[data.type + 'Total']; target.innerText = parseInt(target.innerText, 10) + 1; if (target.innerText === total.innerText) { counter[data.type + 'Well'].classList.remove('cout-warn'); app.alertSuccess('All ' + data.type + ' hashed.'); } } socket.on('event:smoothshorts.newhash', handleNewHash); $shortFormat.tooltip({ html: true, placement: 'top', template: '&lt;div class=&quot;format-tooltip tooltip&quot; role=&quot;tooltip&quot;&gt;&lt;div class=&quot;format-tooltip-arrow tooltip-arrow&quot;&gt;&lt;/div&gt;&lt;div class=&quot;format-tooltip-inner tooltip-inner&quot;&gt;Beware!&lt;/div&gt;&lt;/div&gt;', title: 'Beware!&lt;br /&gt;Changing this setting will invalidate&lt;br /&gt;all short URLs issued so far.', trigger: 'focus', container: 'body' }); $shortFormat.on('shown.bs.tooltip', function(event) { var mouseEnter = function() { window.clearTimeout(hideID); }; var mouseLeave = function() { $shortFormat.tooltip('hide'); }; var scrollHide = function() { $shortFormat.tooltip('hide'); window.clearTimeout(hideID); document.removeEventListener('scroll', scrollHide); }; var formatTooltipId = event.target.attributes.getNamedItem('aria-describedby').value; var formatTooltip = document.getElementById(formatTooltipId); formatTooltip.addEventListener('mouseenter', mouseEnter); formatTooltip.addEventListener('mouseleave', mouseLeave); document.body.addEventListener('scroll', scrollHide); var hideID = window.setTimeout(function() { $shortFormat.tooltip('hide'); }, 7000); }); /** * Invokes module:iconSelect (NodeBB core) to change * copy button's icon * @memberOf acp.controller * @type {function} * @inner * @method selectIcon * @param {MouseEvent} event */ copyButtonIcon.addEventListener('click', function(event) { event.preventDefault(); require(['iconSelect'], function(iconSelect) { iconSelect.init($(event.target.firstElementChild || event.target)); }); }); }); × Search results Close Documentation generated by JSDoc 3.4.0 on 2016-04-22T06:55:56+02:00 using the DocStrap template. "},"lib_hashing.js.html":{"id":"lib_hashing.js.html","title":"Source: lib/hashing.js","body":" Documentation Namespaces acpacp.controllerbackendclientclient.controllernodebb-core Modules backend.hashingbackend.SmoothShortsclient.contextmenuclient.helperclient.settingsclient.sockets Classes client.HashedPostclient.HashedTopic Events nodebb-core.event:&quot;action:post.purge&quot;nodebb-core.event:&quot;action:post.save&quot;nodebb-core.event:&quot;action:topic.purge&quot;nodebb-core.event:&quot;action:topic.save&quot;nodebb-core.event:&quot;filter:admin.header.build&quot;nodebb-core.event:&quot;static:app.load&quot; Source: lib/hashing.js 'use strict'; var async = require.main.require('async'); var nconf = require.main.require('nconf'); var winston = require.main.require('winston'); var db = require.main.require('./src/database'); var xxh = require('xxhash'); /** * Provides methods for internal URL shortening and request resolving * @memberOf backend * @module hashing */ /** @alias module:hashing */ var hashing = {}; /** * Maps 'topics'/'posts' to id key * @type {Object} * @property {string} topics - 'tid' * @property {string} posts - 'pid' * @todo This was once an array. Deserves to be deprecated, since * something like `(topics|posts).substr(0, 1) + 'id'` would be sufficient */ var hashType = { topics: 'tid', posts: 'pid' }; /** * Reads hashes from DB * @param {number} id - Topic or post id * @param {string} type - [hashType]{@link backend.module:hashing.hashType} key * @param {Function} cb */ hashing.getHashForId = function(id, type, cb) { db.getSortedSetRangeByScore(type + ':smoothshorts', 0, -1, id, id, function(err, hash) { if (err) { return cb(err); } var res = { hash: hash[0] }; res[hashType[type]] = id; cb(null, res); }); }; hashing.getHashDelegate = function(type) { return function(id, cb) { hashing.getHashForId.call(this, id, type, cb); }; }; /** * New post event handler * @memberOf backend.module:hashing * @param {Object} postData * @param {Function} cb * @listens nodebb-core.event:&quot;action:post.save&quot; */ hashing.shortenPost = function(postData, cb) { shorten(postData, 'posts', cb); }; /** * New topic event handler * @memberOf backend.module:hashing * @param {Object} topicData * @param {Function} cb * @listens nodebb-core.event:&quot;action:topic.save&quot; */ hashing.shortenTopic = function(topicData, cb) { shorten(topicData, 'topics', cb); }; /** * Purge post event handler * @memberOf backend.module:hashing * @param {number} id * @listens nodebb-core.event:&quot;action:post.purge&quot; */ hashing.purgePost = function(id) { purge(id, 'posts'); }; /** * Purge topic event handler * @memberOf backend.module:hashing * @param {number} id * @listens nodebb-core.event:&quot;action:topic.purge&quot; */ hashing.purgeTopic = function(id) { purge(id, 'topics'); }; /** * Resolves a short URL request and redirects to associated topic/post * @memberOf backend.module:hashing * @param {request} req - Express request instance * @param {response} res - Express response instance * @param {Function} cb */ hashing.resolveHash = function(req, res, cb) { var hash = req.params.hash; async.parallel({ isPost: function(next) { db.isSortedSetMember('posts:smoothshorts', hash, next); }, isTopic: function(next) { db.isSortedSetMember('topics:smoothshorts', hash, next); } }, function(err, result) { if (err) { return cb(err); } else if (result.isPost) { async.waterfall([ function(next) { db.sortedSetScore('posts:smoothshorts', hash, next); }, function(pid, next) { db.getObjectField('post:' + pid, 'tid', function(err, tid) { if (err) { return cb(err); } return next(null, {pid: pid, tid: tid}); }); }, function(data, next) { async.parallel({ rank: function(next) { db.sortedSetRank('tid:' + data.tid + ':posts', data.pid, next); }, slug: function(next) { db.getObjectField('topic:' + data.tid, 'slug', next); } }, function(err, result) { if (err) { return cb(err); } var pIndex = (result.rank !== null) ? (parseInt(result.rank, 10) + 2).toString() : '1'; var uri = '/topic/' + result.slug + '/' + pIndex; next(null, uri); }); } ], function(err, uri) { if (err) { return cb(err); } winston.verbose('[plugins:SmoothShorts] Redirecting ' + hash + ' to ' + uri); res.redirect(uri); }); } else if (result.isTopic) { /* if this hash points to a topic */ async.waterfall([ function(next) { db.sortedSetScore('topics:smoothshorts', hash, next); }, function(tid, next) { db.getObjectField('topic:' + tid, 'slug', next); } ], function(err, slug) { if (err) { return cb(err); } // build URI var uri = '/topic/' + slug + '/'; winston.verbose('[plugins:SmoothShorts] Redirecting ' + hash + ' to ' + uri); // redirect user to URI res.redirect(uri); }); } else { winston.warn('[plugins:SmoothShorts] Couldn\\'t resolve ' + hash); cb(null); } }); }; /** * Stores new hashes in DB * @memberOf backend.module:hashing * @inner * @param {topicData|postdata} data * @param {string} type - [hashType]{@link backend.module:hashing.hashType} key * @param {Function} cb */ function shorten(data, type, cb) { var hash = hashData(data); db.sortedSetAdd(type + ':smoothshorts', data[hashType[type]], hash, function(err) { if (!err) { winston.error('[plugin:smoothshorts] Writing hash to DB failed.' + '(' + hashType[type] + '=' + data[hashType[type]] + ')'); winston.error(err); return cb ? cb(err) : void 0; } winston.verbose(type === 'posts' ? '[plugin:smoothshorts] Hashed post ID ' + data.pid : '[plugin:smoothshorts] Hashed \\'' + data.title + '\\' (ID: ' + data.tid + ')'); return cb ? cb() : void 0; }); } /** * Deletes hashes from DB * @memberOf backend.module:hashing * @inner * @param {number} id * @param {string} type - [hashType]{@link backend.module:hashing.hashType} key */ function purge(id, type) { db.sortedSetsRemoveRangeByScore([type + ':smoothshorts'], id, id, function(err) { if (err) { return winston.error('[plugin:smoothshorts] Deleting hash from DB failed.' + '(' + hashType[type] + '=' + id + ')'); } winston.verbose('[plugin:smoothshorts] Deleted hash for ' + type.substring(0, type.length - 1) + ' ID ' + id); }); } /** * Creates hashes for short URLs * @memberOf backend.module:hashing * @inner * @param {topicData|postData} data */ function hashData(data) { var key = nconf.get('secret'); key = parseInt('0x' + key.substring(0, key.indexOf('-')), 16); var hash = xxh.hash(new Buffer(JSON.stringify(data)), key).toString(16); // don't take any chances of leaking the secret around; // not even just parts of it. ;) key = null; return hash; } module.exports = hashing; × Search results Close Documentation generated by JSDoc 3.4.0 on 2016-04-22T06:55:56+02:00 using the DocStrap template. "},"lib_controller.js.html":{"id":"lib_controller.js.html","title":"Source: lib/controller.js","body":" Documentation Namespaces acpacp.controllerbackendclientclient.controllernodebb-core Modules backend.hashingbackend.SmoothShortsclient.contextmenuclient.helperclient.settingsclient.sockets Classes client.HashedPostclient.HashedTopic Events nodebb-core.event:&quot;action:post.purge&quot;nodebb-core.event:&quot;action:post.save&quot;nodebb-core.event:&quot;action:topic.purge&quot;nodebb-core.event:&quot;action:topic.save&quot;nodebb-core.event:&quot;filter:admin.header.build&quot;nodebb-core.event:&quot;static:app.load&quot; Source: lib/controller.js 'use strict'; var async = require.main.require('async'); var nconf = require.main.require('nconf'); var winston = require.main.require('winston'); var db = require.main.require('./src/database'); var PluginSocket = require.main.require('./src/socket.io/plugins'); var AdminSocket = require.main.require('./src/socket.io/admin'); var sockets = require('./sockets'); var settings = require('./settings'); var hashing = require('./hashing'); /** * SmoothShorts - Seamless short URLs for NodeBB * @author Raphael Beer &lt;raphael.beer@protonmail.com&gt; * @license [MIT]{@link https://raw.githubusercontent.com/rbeer/nodebb-plugin-smoothshorts/master/LICENSE} * @memberOf backend * @module SmoothShorts * @requires backend.module:hashing * @requires backend.module:settings * @requires backend.module:sockets */ /** @alias module:SmoothShorts */ var SmoothShorts = { admin: {}, purgePost: hashing.purgePost, purgeTopic: hashing.purgeTopic, shortenPost: hashing.shortenPost, shortenTopic: hashing.shortenTopic }; /** * Plugin initialisation * @memberOf backend.module:SmoothShorts * @method init * @param {app} app - Express app instance * @param {Function} cb * @listens nodebb-core.event:&quot;static:app.load&quot; */ SmoothShorts.init = function(app, cb) { settings.load(function(err) { if (err) { return cb(err); } setRoutes(app.router, app.middleware); openSockets(); return cb(null, app); }); }; /** * Adds menu entry to ACP/Plugins * @memberOf backend.module:SmoothShorts * @method addMenuItem * @param {Object} custom_header - See event for structure details * @param {Function} cb * @listens nodebb-core.event:&quot;filter:admin.header.build&quot; */ SmoothShorts.admin.addMenuItem = function(custom_header, cb) { custom_header.plugins.push({ route: '/plugins/smoothshorts', icon: 'fa-location-arrow', name: 'SmoothShorts' }); cb(null, custom_header); }; /** * Registers socket.io methods * @memberOf backend.module:SmoothShorts */ function openSockets() { PluginSocket.SmoothShorts = sockets.plugin; AdminSocket.plugins.SmoothShorts = sockets.admin; } /** * Registers Express routes * @memberOf backend.module:SmoothShorts * @param {router} router - NodeBB's Express plugin router * @param {Object.&lt;string, middleware&gt;} middleware - NodeBB's Express middlewares */ function setRoutes(router, middleware) { var format = settings.local.shortFormat; var path = !format ? '/ss/:hash' : format.slice(format.indexOf('/')); router.get(path, validateHash, hashing.resolveHash); winston.info('[plugins:SmoothShorts] Listening for short URLs on:', path); router.get('/admin/plugins/smoothshorts', middleware.applyCSRF, middleware.admin.buildHeader, renderAdmin); router.get('/api/admin/plugins/SmoothShorts', middleware.applyCSRF, renderAdmin); } /** * Validates that a request is meant for the plugin. * The [format of short URLs']{@link backend.module:settings.shortFormat} can be * as basic as domain.com/:hash, which could conflict with other plugin routes, * e.g. those from [nodebb-plugin-custom-pages]{@link https://github.com/psychobunny/nodebb-plugin-custom-pages}. * @memberOf backend.SmoothShorts * @type {middleware} * @param {request} req - Express request instance * @param {response} res - Express response instance * @param {Function} next */ function validateHash(req, res, next) { return next(/^[\\dabcdef]{8}$/.test(req.params.hash) ? void 0 : 'route'); } /** * Gathers data for and renders ACP page * @memberOf backend.SmoothShorts * @param {request} req - Express request instance * @param {response} res - Express response instance * @param {Function} next */ function renderAdmin(req, res, next) { async.parallel({ postCount: function(next) { db.sortedSetCard('posts:pid', next); }, postHashCount: function(next) { db.sortedSetCard('posts:smoothshorts', next); }, topicCount: function(next) { db.sortedSetCard('topics:tid', next); }, topicHashCount: function(next) { db.sortedSetCard('topics:smoothshorts', next); } }, function(err, result) { if (err) { return next(err); } var data = { // left side, &quot;Settings&quot; useModKey: settings.local.useModKey, modKey: {}, shortFormat: settings.local.shortFormat, shortFormatDefault: nconf.get('url').replace(/http[s]?:\\/\\//, '') + '/ss/:hash', copyButtonClass: settings.local.copyButtonClass, // right side, &quot;Status&quot; postCount: result.postCount, postHashCount: result.postHashCount, topicCount: result.topicCount, topicHashCount: result.topicHashCount, postStatus: (result.postCount !== result.postHashCount) ? 'cout-warn' : '', topicStatus: (result.topicCount !== result.topicHashCount) ? 'cout-warn' : '' }; data.modKey[settings.local.modKey] = true; res.render('admin/plugins/smoothshorts/index', data); }); } module.exports = SmoothShorts; × Search results Close Documentation generated by JSDoc 3.4.0 on 2016-04-22T06:55:56+02:00 using the DocStrap template. "},"public_scripts_controller.js.html":{"id":"public_scripts_controller.js.html","title":"Source: public/scripts/controller.js","body":" Documentation Namespaces acpacp.controllerbackendclientclient.controllernodebb-core Modules backend.hashingbackend.SmoothShortsclient.contextmenuclient.helperclient.settingsclient.sockets Classes client.HashedPostclient.HashedTopic Events nodebb-core.event:&quot;action:post.purge&quot;nodebb-core.event:&quot;action:post.save&quot;nodebb-core.event:&quot;action:topic.purge&quot;nodebb-core.event:&quot;action:topic.save&quot;nodebb-core.event:&quot;filter:admin.header.build&quot;nodebb-core.event:&quot;static:app.load&quot; Source: public/scripts/controller.js /* global require, ajaxify, app */ (function() { 'use strict'; var deps = [ 'plugins/smoothshorts/settings', 'plugins/smoothshorts/helper', 'plugins/smoothshorts/sockets', 'plugins/smoothshorts/contextmenu', 'plugins/smoothshorts/hashed/post', 'plugins/smoothshorts/hashed/topic' ]; require(deps, function(settings, helper, sockets, cmenu, HashedPost, HashedTopic) { /** * @namespace controller * @memberOf client */ /** * NodeBB's ajaxify.data object * (showing only properties plugin is working with) * @typedef {Object} client.controller~AjaxifyData * @property {?Array.&lt;client.controller~CategoryData&gt;} categories * @property {?Array.&lt;client.controller~PostData&gt;} posts * @property {?Array.&lt;client.controller~TopicData&gt;} topics */ /** * Ajaxify data, describing a teaser * (showing only properties plugin is working with) * @typedef {Object} client.controller~TeaserData * @property {?string} pid - Introduced in NodeBB v1.0.3; earlier versions need to get it with {@link client.controller~ensureTeaserPids} * @property {string} url - URL to post */ /** * Ajaxify data, describing a category * (showing only properties plugin is working with) * @typedef {Object} client.controller~CategoryData * @property {Array.&lt;client.controller~PostData&gt;} posts - First entry is the teaser post. {@link client.controller~ensureTeaserPids} uses it, when [teaser object]{@link client.controller~TeaserData} has no pid. * @property {client.controller~TeaserData} teaser */ /** * Ajaxify data, describing a topic * (showing only properties plugin is working with) * @typedef {Object} client.controller~TopicData * @property {string} slug - Topic's URL slug * @property {string} tid - Topic's ID * @property {string} postcount - Total number of posts in topic * @property {string} title - Topic's title * @property {?client.controller~TeaserData} teaser - Topic's teaser */ /** * Ajaxify data, describing a post * (showing only properties plugin is working with) * @typedef {Object} client.controller~PostData * @property {client.controller~TopicData} topic - Topic the post belongs to * @property {number} index - Index of post in topic * @property {string} pid - Post's ID */ /** * Type identifier for [HashedPost]{@link client.HashedPost} or [HashedTopic]{@link client.HashedTopic} * @typedef {string} client.controller~hashedType * @example * 'topics' or 'posts' */ /** * Parses [AjaxifyData]{@link client.controller~AjaxifyData} for posts/categories/topics * @memberOf client.controller * @inner */ function parseAjaxifyData() { var data = ajaxify.data; var dataKey = data.topics ? 'topics' : data.categories ? 'categories' : null; var pageData = dataKey ? data[dataKey] : void 0; if (data.posts) { sockets.getHashes('posts', data.posts.map(mapHelperDelegate('posts')), addHashes); } else if (pageData) { ensureTeaserPids(pageData); sockets.getHashes('posts', data[dataKey].filter(helper.teaserFilter).map(mapHelperDelegate('teaser', pageData)), addHashes); if (dataKey === 'topics') { sockets.getHashes('topics', data[dataKey].map(mapHelperDelegate('topics')), addHashes); } } } /** * Ensures that teaser objects have a pid. * @memberOf client.controller * @inner * @param {client.controller~AjaxifyData} pageData */ function ensureTeaserPids(pageData) { if (teasersHavePids(pageData)) { return pageData; } return pageData.map(function(dataObject) { if (dataObject.teaser) { dataObject.teaser.pid = dataObject.posts[0].pid; } return dataObject; }); } /** * Checks whether current pages teaser objects have pids * @memberOf client.controller * @inner * @param {client.controller~AjaxifyData} pageData * @return {bool} - Result of an [].some() run. If one teaser has a pid, all do. */ function teasersHavePids(pageData) { return pageData.some(function(dataObject) { return dataObject.teaser &amp;&amp; dataObject.teaser.pid !== void 0; }); } function mapHelperDelegate(type) { return function mapHelper(mapObj) { var fn = helper[type + 'Map']; return fn(mapObj, type === 'topics' ? HashedTopic : HashedPost); }; } /** * Parses incoming controller~AjaxifyData when user scrolling * triggers loading new entries * @memberOf client.controller * @inner * @param {SomeJQueryEventObject} event * @param {client.controller~AjaxifyData} data */ function addOnScrollLoad(event, data) { var type = event.type.split(':')[1]; sockets.getHashes(type, data[type].map(mapHelperDelegate(type)), addHashes); } /** * Adds from backend received hashes to topic and post links * @memberOf client.controller * @inner * @param {client.controller~hashedType} type * @param {Array.&lt;client.HashedPost|client.HashedTopic&gt;} hashedObjects - Objects to add hashes for */ function addHashes(type, hashedObjects) { hashedObjects.forEach(function(obj) { obj.addHashToAnchor(); cmenu.setHooks(obj); if (obj instanceof HashedPost &amp;&amp; obj.shouldHaveButton() &amp;&amp; !obj.hasButton()) { obj.addButton(buttonClickDelegate); } }); } function buttonClickDelegate(hashedPost) { /** * One-click button click handler * @memberOf client.controller * @inner */ var copyShortUrl = function() { var isCopied; var url = hashedPost.shortUrlContainer.value; hashedPost.shortUrlContainer.select(); isCopied = document.execCommand('copy'); require(['translator'], function(translator) { var stringTag = translator.compile('smoothshorts:hashbutton.' + (isCopied ? 'success' : 'error'), (isCopied ? url : void 0)); translator.translate(stringTag, 'en_GB', function(message) { if (isCopied) { app.alertSuccess(message); } else { app.alertError(message); } }); }); }; return copyShortUrl; } /** * Entry point; sets hooks * @memberOf client.controller * @inner */ function init() { $(window).on('action:ajaxify.contentLoaded', parseAjaxifyData); $(window).on('action:topics.loaded action:posts.loaded', addOnScrollLoad); parseAjaxifyData(); } // ENTRY POINT settings.load(init); }); })(); × Search results Close Documentation generated by JSDoc 3.4.0 on 2016-04-22T06:55:56+02:00 using the DocStrap template. "},"public_scripts_hashed_post.js.html":{"id":"public_scripts_hashed_post.js.html","title":"Source: public/scripts/hashed/post.js","body":" Documentation Namespaces acpacp.controllerbackendclientclient.controllernodebb-core Modules backend.hashingbackend.SmoothShortsclient.contextmenuclient.helperclient.settingsclient.sockets Classes client.HashedPostclient.HashedTopic Events nodebb-core.event:&quot;action:post.purge&quot;nodebb-core.event:&quot;action:post.save&quot;nodebb-core.event:&quot;action:topic.purge&quot;nodebb-core.event:&quot;action:topic.save&quot;nodebb-core.event:&quot;filter:admin.header.build&quot;nodebb-core.event:&quot;static:app.load&quot; Source: public/scripts/hashed/post.js /* global define, ajaxify, app */ (function() { var deps = [ 'plugins/smoothshorts/settings', 'plugins/smoothshorts/helper' ]; define('plugins/smoothshorts/hashed/post', deps, function(settings, helper) { 'use strict'; /** * Represents a shortened post URL. * This URL can belong to multiple HTMLAnchorElements in the DOM. * @constructs client.HashedPost * @param {!Object} data * @param {!string} data.pid * @param {?string} data.url * @param {?number} data.index * @param {!Object} data.topicData * @param {!string} data.topicData.title * @param {?string} data.topicData.slug */ var HashedPost = function(data) { /** * Posts's URL * @instance * @type {string} */ this.url = data.url || '/topic/' + data.topicData.slug + '/' + data.index; /** * Post's ID * @instance * @type {number} */ this.pid = data.pid; /** * Index of post in its topic * @instance * @type {number} */ this.index = !isNaN(data.index) ? data.index : parseInt(data.url.match(/\\d*(?:#.*)?$/), 10); /** * Anchor elements using post's URL * @instance * @type {Array.&lt;HTMLAnchorElement&gt;} */ this.anchors = getAnchors(this.url, data.topicData.title); /** * Hash used for this post's short URL * @instance * @type {string} */ this.hash = null; /** * smoothshorts/copybutton component * @instance * @type {HTMLDivElement} */ this.button = null; /** * Text input element to copy short URL from * @instance * @type {HTMLInputElement} */ this.shortUrlContainer = null; return this; }; /** * Adds data-smoothhash=&quot;[hash]{@link client.HashedPost#hash}&quot; to * all [anchors]{@link client.HashedPost#anchors} * @instance * @memberOf client.HashedPost * @todo Extract superclass - DRY with {@link HashedTopic#addHashToAnchor} */ HashedPost.prototype.addHashToAnchor = function() { var self = this; this.anchors.forEach(function(anchor) { anchor.dataset.smoothhash = self.hash; }); }; /** * Inserts instances [button]{@link client.HashedPost#button} directly * after all [anchors]{@link client.HashedPost#anchors} * @instance * @memberOf client.HashedPost * @param {client.controller.buttonClickDelegate} handler - Called on click */ HashedPost.prototype.addButton = function(handler) { var self = this; var buttonData = { shortUrl: helper.buildShortURL(this.hash), copyButtonClass: settings.copyButtonClass }; app.parseAndTranslate('smoothshorts/copybutton', buttonData, function($element) { $(self.anchors[0]).after($element); $element.children('i').tooltip(); self.button = $element[0]; self.shortUrlContainer = self.button.querySelector('input'); self.button.addEventListener('click', handler.call(null, self)); }); }; /** * Performs tests (e.g. 'copy' command availabilty) whether * [button]{@link client.HashedPost#button} should be added or not. * @instance * @memberOf client.HashedPost * @return {bool} False as soon as one test fails */ HashedPost.prototype.shouldHaveButton = function() { var tplRegX = /^topic$|(?:account|groups)\\/(?:posts|profile|best|(?:up|down)voted|details|favourites)/; var itShould = true; switch(false) { case (itShould = document.queryCommandSupported('copy')): break; case (itShould = tplRegX.test(ajaxify.data.template.name)): break; } return itShould; }; /** * Tests whether instance already has a button * @instance * @memberOf client.HashedPost * @return {Boolean} */ HashedPost.prototype.hasButton = function() { return !!this.button; }; /** * Collects anchor elements from DOM and stores them * in instances [anchors]{@link client.HashedPost#anchors} * @inner * @memberOf client.HashedPost * @param {string} url - URL to find anchors * @param {string} topicTitle - Title of post's topic to filter topic links * @todo Extract superclass - DRY with {@link client.HashedTopic~getAnchors} */ function getAnchors(url, topicTitle) { var anchors = document.querySelectorAll(':not([component=&quot;notifications/list&quot;]) a[href=&quot;' + url + '&quot;]'); return helper.ArrayFromNodeList(anchors).filter(function(anchor) { return anchor.textContent !== topicTitle; }); } return HashedPost; }); })(); × Search results Close Documentation generated by JSDoc 3.4.0 on 2016-04-22T06:55:56+02:00 using the DocStrap template. "},"public_scripts_hashed_topic.js.html":{"id":"public_scripts_hashed_topic.js.html","title":"Source: public/scripts/hashed/topic.js","body":" Documentation Namespaces acpacp.controllerbackendclientclient.controllernodebb-core Modules backend.hashingbackend.SmoothShortsclient.contextmenuclient.helperclient.settingsclient.sockets Classes client.HashedPostclient.HashedTopic Events nodebb-core.event:&quot;action:post.purge&quot;nodebb-core.event:&quot;action:post.save&quot;nodebb-core.event:&quot;action:topic.purge&quot;nodebb-core.event:&quot;action:topic.save&quot;nodebb-core.event:&quot;filter:admin.header.build&quot;nodebb-core.event:&quot;static:app.load&quot; Source: public/scripts/hashed/topic.js /* global define */ define('plugins/smoothshorts/hashed/topic', ['plugins/smoothshorts/helper'], function(helper) { 'use strict'; /** * Represents a shortened topic URL. * This URL can belong to multiple HTMLAnchorElements in the DOM. * @constructs client.HashedTopic * @param {!Object} data * @param {!string} data.slug * @param {!string} data.tid * @param {!string} data.postcount * @param {!string} data.title */ var HashedTopic = function(data) { /** * Topic's URL * @instance * @type {string} */ this.url = '/topic/' + data.slug; /** * Topic's ID * @instance * @type {number} */ this.tid = data.tid; /** * Anchor elements using topic's URL * @instance * @type {Array.&lt;HTMLAnchorElement&gt;} */ this.anchors = getAnchors(this.url, data.postcount, data.title); /** * Hash used for this topic's short URL * @instance * @type {string} */ this.hash = null; return this; }; /** * Adds data-smoothhash=&quot;[hash]{@link client.HashedTopic#hash}&quot; to * all [anchors]{@link client.HashedTopic#anchors} * @instance * @memberOf client.HashedTopic * @todo Extract superclass - DRY with {@link client.HashedPost#addHashToAnchor} */ HashedTopic.prototype.addHashToAnchor = function() { var self = this; this.anchors.forEach(function(anchor) { anchor.dataset.smoothhash = self.hash; }); }; /** * Collects anchor elements from DOM and stores them * in instances [anchors]{@link client.HashedTopic#anchors} * @inner * @memberOf client.HashedTopic * @param {!string} url - URL to find anchors * @param {!string} postcount - Topic's postcount to filter out something - forgot what, though; might even be deprecated... ^_^ * @param {!string} title - Topic's title to filter out false selector positives * @todo Extract superclass - DRY with {@link client.HashedPost~getAnchors} */ function getAnchors(url, postcount, title) { var anchors = document.querySelectorAll('[component=&quot;category/topic&quot;] a'); return helper.ArrayFromNodeList(anchors).filter(function(element) { return (postcount === '1' &amp;&amp; element.getAttribute('href') === url) || (element.textContent.trim() === title); }); } return HashedTopic; }); × Search results Close Documentation generated by JSDoc 3.4.0 on 2016-04-22T06:55:56+02:00 using the DocStrap template. "},"public_scripts_contextmenu.js.html":{"id":"public_scripts_contextmenu.js.html","title":"Source: public/scripts/contextmenu.js","body":" Documentation Namespaces acpacp.controllerbackendclientclient.controllernodebb-core Modules backend.hashingbackend.SmoothShortsclient.contextmenuclient.helperclient.settingsclient.sockets Classes client.HashedPostclient.HashedTopic Events nodebb-core.event:&quot;action:post.purge&quot;nodebb-core.event:&quot;action:post.save&quot;nodebb-core.event:&quot;action:topic.purge&quot;nodebb-core.event:&quot;action:topic.save&quot;nodebb-core.event:&quot;filter:admin.header.build&quot;nodebb-core.event:&quot;static:app.load&quot; Source: public/scripts/contextmenu.js /* global define */ (function() { var deps = [ 'plugins/smoothshorts/helper', 'plugins/smoothshorts/settings' ]; /** * Provides context menu method * @memberOf client * @module contextmenu */ define('plugins/smoothshorts/contextmenu', deps, function(helper, settings) { /** @alias module:contextmenu */ var cmenu = { /** * Indicates whether context menu is open * @memberof client.module:contextmenu * @type {Boolean} * @default false */ menuCalled: false, /** * Element context menu has been called on * @memberof client.module:contextmenu * @type {HTMLAnchorElement} * @default null */ lastCalledOn: null, /** * href value to restore on [lastCalledOn]{@link client.module:contextmenu.lastCalledOn} * @memberof client.module:contextmenu * @type {String} */ lastOriginalURL: '' }; /** * Sets hooks 'contextmenu' on given [HashedPost]{@link client.HashedPost}|[HashedTopic]{@link client.HashedTopic}'s anchors * and 'mousedown' on document. * @memberof client.module:contextmenu * @param {(HashedPost|HashedTopic)} HashedObject */ cmenu.setHooks = function(HashedObject) { HashedObject.anchors.forEach(function(obj) { obj.addEventListener('contextmenu', replaceWithShortURL, false); }); document.addEventListener('mousedown', restoreOriginalURL, false); }; /** * Restores [lastOriginalURL]{@link client.module:contextmenu.lastOriginalURL} * on [lastCalledOn]{@link client.module:contextmenu.lastCalledOn} * @memberof client.module:contextmenu * @inner */ function restoreOriginalURL() { if (cmenu.menuCalled) { cmenu.lastCalledOn.href = cmenu.lastOriginalURL; cmenu.lastOriginalURL = ''; cmenu.menuCalled = false; cmenu.lastCalledOn = null; } } /** * Replaces href of an anchor with short URL. * @memberof client.module:contextmenu * @inner * @param {MouseEvent} event */ function replaceWithShortURL(event) { var hash; var clickedAnchor = event.target.dataset.smoothhash ? event.target : $(event.target).parents('[data-smoothhash]')[0]; if ((settings.modKey !== '' &amp;&amp; !event[settings.modKey + 'Key']) || !clickedAnchor) { return; } hash = clickedAnchor.dataset.smoothhash; cmenu.menuCalled = true; cmenu.lastCalledOn = clickedAnchor; cmenu.lastOriginalURL = cmenu.lastCalledOn.href; cmenu.lastCalledOn.href = helper.buildShortURL(hash); } return cmenu; }); })(); × Search results Close Documentation generated by JSDoc 3.4.0 on 2016-04-22T06:55:56+02:00 using the DocStrap template. "},"public_scripts_helper.js.html":{"id":"public_scripts_helper.js.html","title":"Source: public/scripts/helper.js","body":" Documentation Namespaces acpacp.controllerbackendclientclient.controllernodebb-core Modules backend.hashingbackend.SmoothShortsclient.contextmenuclient.helperclient.settingsclient.sockets Classes client.HashedPostclient.HashedTopic Events nodebb-core.event:&quot;action:post.purge&quot;nodebb-core.event:&quot;action:post.save&quot;nodebb-core.event:&quot;action:topic.purge&quot;nodebb-core.event:&quot;action:topic.save&quot;nodebb-core.event:&quot;filter:admin.header.build&quot;nodebb-core.event:&quot;static:app.load&quot; Source: public/scripts/helper.js /* global define, ajaxify */ (function() { /** * Provides helper functions (for e.g. [].map, [].filter) * @memberOf client * @module helper */ define('plugins/smoothshorts/helper', ['plugins/smoothshorts/settings'], function(settings) { 'use strict'; /** @alias module:helper */ var helper = {}; /** * Polyfill for Array.from * @memberOf client.module:helper * @param {NodeList} nodeList - List of HTMLElements * @return {Array} */ helper.ArrayFromNodeList = function(nodeList) { if (!Array.from) { var nodeArray = []; for (var i = 0; i &lt; nodeList.length; i++) { nodeArray.push(nodeList.item(i)); } return nodeArray; } else { return Array.from(nodeList); } }; /** * Maps [TopicData]{@link client.controller~TopicData} into [HashedTopic]{@link client.HashedTopic} objects * @memberOf client.module:helper * @param {client.controller~TopicData} topic * @param {client.HashedTopic} HashedTopic - NOT an instance! * @return {client.HashedTopic} - New HashedTopic instance */ helper.topicsMap = function(topic, HashedTopic) { return new HashedTopic({ slug: topic.slug, tid: topic.tid, postcount: topic.postcount, title: topic.title }); }; /** * Maps [PostData]{@link client.controller~PostData} into [HashedPost]{@link client.HashedPost} objects * @memberOf client.module:helper * @param {client.controller~PostData} post * @param {client.HashedPost} HashedPost - NOT an instance! * @return {client.HashedPost} - New HashedPost instance */ helper.postsMap = function(post, HashedPost) { var topicTitle = post.topic ? post.topic.title : ajaxify.data.title; var topicSlug = post.topic ? post.topic.slug : ajaxify.data.slug; var index = post.topic ? post.index : post.index + 1; return new HashedPost({ pid: post.pid, url: null, index: index, topicData: { title: topicTitle, slug: topicSlug } }); }; /** * Maps [TeaserData]{@link client.controller~TeaserData} into [HashedPost]{@link client.HashedPost} objects * @memberOf client.module:helper * @param {client.controller~TeaserData} topic * @param {client.HashedPost} HashedPost - NOT an instance! * @return {client.HashedPost} - New HashedPost instance */ helper.teaserMap = function(topic, HashedPost) { return new HashedPost({ pid: topic.teaser.pid, url: topic.teaser.url, index: topic.teaser.index, topicData: { title: topic.title, slug: topic.slug } }); }; /** * Filters [TopicData]{@link client.controller~TopicData} or [CategoryData]{@link client.controller~CategoryData} objects without [TeaserData]{@link client.controller~TeaserData} member * @memberOf client.module:helper * @param {client.controller~TopicData|client.controller~CategoryData} obj [description] * @return {bool} */ helper.teaserFilter = function(obj) { return !!obj.teaser; }; /** * Builds short URL from [hash]{@link client.HashedPost#hash}, using * [shortFormat]{@link client.module:settings.shortFormat} * @memberOf client.module:helper * @param {client.HashedPost#hash|client.HashedTopic#hash} hash * @return {string} */ helper.buildShortURL = function(hash) { return location.protocol + '//' + settings.shortFormat.replace(':hash', hash); }; return helper; }); }); × Search results Close Documentation generated by JSDoc 3.4.0 on 2016-04-22T06:55:56+02:00 using the DocStrap template. "},"public_scripts_settings.js.html":{"id":"public_scripts_settings.js.html","title":"Source: public/scripts/settings.js","body":" Documentation Namespaces acpacp.controllerbackendclientclient.controllernodebb-core Modules backend.hashingbackend.SmoothShortsclient.contextmenuclient.helperclient.settingsclient.sockets Classes client.HashedPostclient.HashedTopic Events nodebb-core.event:&quot;action:post.purge&quot;nodebb-core.event:&quot;action:post.save&quot;nodebb-core.event:&quot;action:topic.purge&quot;nodebb-core.event:&quot;action:topic.save&quot;nodebb-core.event:&quot;filter:admin.header.build&quot;nodebb-core.event:&quot;static:app.load&quot; Source: public/scripts/settings.js /* global define, socket */ /** * Provides plugin's settings * @memberOf client * @module settings */ define('plugins/smoothshorts/settings', function() { 'use strict'; /** @alias module:settings */ var settings = { /** * Modifier key (ctrl, alt or shift) to enable URL replacement * @memberOf client.module:settings * @type {string} */ modKey: '', /** * Short URLs will be built with this format * @memberOf client.module:settings * @type {string} * @example * 'short.com/ss/:hash' * 'short.com/:hash' * 'short.com/:hash/yolo' */ shortFormat: '', /** * CSS class name for copy button icon * @memberOf client.module:settings * @type {String} * @default fa-external-link */ copyButtonClass: 'fa-external-link' }; /** * Load settings from backend * @memberOf client.module:settings * @param {Function} cb - Called when settings have been received */ settings.load = function(cb) { socket.emit('plugins.SmoothShorts.getConfig', function(data) { settings.modKey = data.modKey; settings.shortFormat = data.shortFormat; settings.copyButtonClass = data.copyButtonClass; return cb(); }); }; return settings; }); × Search results Close Documentation generated by JSDoc 3.4.0 on 2016-04-22T06:55:56+02:00 using the DocStrap template. "},"public_scripts_sockets.js.html":{"id":"public_scripts_sockets.js.html","title":"Source: public/scripts/sockets.js","body":" Documentation Namespaces acpacp.controllerbackendclientclient.controllernodebb-core Modules backend.hashingbackend.SmoothShortsclient.contextmenuclient.helperclient.settingsclient.sockets Classes client.HashedPostclient.HashedTopic Events nodebb-core.event:&quot;action:post.purge&quot;nodebb-core.event:&quot;action:post.save&quot;nodebb-core.event:&quot;action:topic.purge&quot;nodebb-core.event:&quot;action:topic.save&quot;nodebb-core.event:&quot;filter:admin.header.build&quot;nodebb-core.event:&quot;static:app.load&quot; Source: public/scripts/sockets.js /* global define, socket */ /** * Provides socket.io connections to backend * @memberOf client * @module sockets */ define('plugins/smoothshorts/sockets', function() { 'use strict'; /** @alias module:sockets */ var sockets = {}; /** * Requests hashes * @memberOf client.module:sockets * @param {client.controller~hashedType} type * @param {Array&lt;client.HashedPost|client.HashedTopic&gt;} hashedObjects - Objects to get hashes for * @param {client.controller~addHashes} cb */ sockets.getHashes = function(type, hashedObjects, cb) { var ids = hashedObjects.map(function(obj) { return obj[getHashesType[type]]; }); socket.emit('plugins.SmoothShorts.getHashes', { ids: ids, type: type }, function(err, hashes) { if (err) { return console.error(err); } cb(type, hashedObjects.map(function(obj, idx) { obj.hash = hashes[idx].hash; return obj; })); }); }; var getHashesType = { posts: 'pid', topics: 'tid' }; return sockets; }); × Search results Close Documentation generated by JSDoc 3.4.0 on 2016-04-22T06:55:56+02:00 using the DocStrap template. "},"nodebb_events.js.html":{"id":"nodebb_events.js.html","title":"Source: nodebb_events.js","body":" Documentation Namespaces acpacp.controllerbackendclientclient.controllernodebb-core Modules backend.hashingbackend.SmoothShortsclient.contextmenuclient.helperclient.settingsclient.sockets Classes client.HashedPostclient.HashedTopic Events nodebb-core.event:&quot;action:post.purge&quot;nodebb-core.event:&quot;action:post.save&quot;nodebb-core.event:&quot;action:topic.purge&quot;nodebb-core.event:&quot;action:topic.save&quot;nodebb-core.event:&quot;filter:admin.header.build&quot;nodebb-core.event:&quot;static:app.load&quot; Source: nodebb_events.js /** * Reports that NodeBB is in startup sequence. Used to initialise plugins * @event nodebb-core.&quot;static:app.load&quot; * @property {app} app - Express app object for access to router, middlewares, etc. * @property {function} cb - Expects to be called with updated app object * @example * // listener * function init(app, cb) { * app.router.get('/foo/:bar', app.middleware.handleRoute); * try { * couldFail(); * } catch (err) { * return cb(err); * } * cb(null, app); * } * * // plugin.json * &quot;hooks&quot;: [ * { &quot;hook&quot;: &quot;static:app.load&quot;, &quot;method&quot;: &quot;init&quot; } * ] */ /** * Reports that NodeBB is ready to accept custom ACP menu items * @event nodebb-core.&quot;filter:admin.header.build&quot; * @property {Object} custom_header * @property {Array.&lt;Object&gt;} custom_header.plugins - Plugin menu entries; see example for structure * @property {function} cb - Expects to be called with updated custom_header object * @example * // listener * function addMenuItem(custom_header, cb) { * custom_header.plugins.push({ * route: '/plugins/smoothshorts', // Path for menu entry, relative to /admin/ * icon: 'fa-location-arrow', // Fontawesome class name for icon shown on menu entry (legacy! &lt;= NodeBB 0.7.x) * name: 'SmoothShorts' // Text shown on menu entry * }); * cb(null, custom_header); * }; * * // plugin.json * &quot;hooks&quot;: [ * { &quot;hook&quot;: &quot;filter:admin.header.build&quot;, &quot;method&quot;: &quot;addMenuItem&quot; } * ] */ /** * Emitted when a new topic is being saved * @event nodebb-core.&quot;action:topic.save&quot; * @example * // listener * function topicSaveHandler(topicData) { * pluginMagic(topicData.title, topicData.tid, topicData.uid, function(err) { * if(err) { * return console.error(err); * } * console.debug(`User ID ${topicData.uid} just yanked ${topicData.title} out of a hat! Magic be magical!`); * }); * } * * // plugin.json * &quot;hooks&quot;: [ * { &quot;hook&quot;: &quot;action:topic.save&quot;, &quot;method&quot;: &quot;topicSaveHandler&quot; }, * ] */ /** * Emitted when a topic is being purged (i.e. deleted from DB) * @event nodebb-core.&quot;action:topic.purge&quot; * @example * // listener * function topicPurgeHandler(tid) { * console.debug(`Topic with id ${tid} has been purged`); * } * // plugin.json * &quot;hooks&quot;: [ * { &quot;hook&quot;: &quot;action:topic.purge&quot;, &quot;method&quot;: &quot;topicPurgeHandler&quot; }, * ] */ /** * Emitted when a new post is being saved * @event nodebb-core.&quot;action:post.save&quot; * @example * // listener * function postSaveHandler(postData) { * pluginMagic(postData.content, postData.pid, function(err) { * if(err) { * return console.error(err); * } * console.debug(`... and all the sudden ${postData.tid} has a post more. *poof*!`); * }); * } * * // plugin.json * &quot;hooks&quot;: [ * { &quot;hook&quot;: &quot;action:post.save&quot;, &quot;method&quot;: &quot;postSaveHandler&quot; }, * ] */ /** * Emitted when a post is being purged (i.e. deleted from DB) * @event nodebb-core.&quot;action:post.purge&quot; * @example * // listener * function postPurgeHandler(pid) { * console.debug(`Post with id ${pid} has been deleted`); * } * * // plugin.json * &quot;hooks&quot;: [ * { &quot;hook&quot;: &quot;action:post.purge&quot;, &quot;method&quot;: &quot;postPurgeHandler&quot; }, * ] */ × Search results Close Documentation generated by JSDoc 3.4.0 on 2016-04-22T06:55:56+02:00 using the DocStrap template. "},"modules.list.html":{"id":"modules.list.html","title":"Modules","body":" Documentation Namespaces acpacp.controllerbackendclientclient.controllernodebb-core Modules backend.hashingbackend.SmoothShortsclient.contextmenuclient.helperclient.settingsclient.sockets Classes client.HashedPostclient.HashedTopic Events nodebb-core.event:&quot;action:post.purge&quot;nodebb-core.event:&quot;action:post.save&quot;nodebb-core.event:&quot;action:topic.purge&quot;nodebb-core.event:&quot;action:topic.save&quot;nodebb-core.event:&quot;filter:admin.header.build&quot;nodebb-core.event:&quot;static:app.load&quot; Modules Classes HashedPost HashedTopic Namespaces acp controller backend client controller nodebb-core Events &quot;action:post.purge&quot; Emitted when a post is being purged (i.e. deleted from DB) Source: nodebb_events.js, line 101 Listeners of This Event: backend.module:hashing.hashing.purgePost Example // listener function postPurgeHandler(pid) { console.debug(`Post with id ${pid} has been deleted`); } // plugin.json &quot;hooks&quot;: [ { &quot;hook&quot;: &quot;action:post.purge&quot;, &quot;method&quot;: &quot;postPurgeHandler&quot; }, ] &quot;action:post.save&quot; Emitted when a new post is being saved Source: nodebb_events.js, line 81 Listeners of This Event: backend.module:hashing.hashing.shortenPost Example // listener function postSaveHandler(postData) { pluginMagic(postData.content, postData.pid, function(err) { if(err) { return console.error(err); } console.debug(`... and all the sudden ${postData.tid} has a post more. *poof*!`); }); } // plugin.json &quot;hooks&quot;: [ { &quot;hook&quot;: &quot;action:post.save&quot;, &quot;method&quot;: &quot;postSaveHandler&quot; }, ] &quot;action:topic.purge&quot; Emitted when a topic is being purged (i.e. deleted from DB) Source: nodebb_events.js, line 67 Listeners of This Event: backend.module:hashing.hashing.purgeTopic Example // listener function topicPurgeHandler(tid) { console.debug(`Topic with id ${tid} has been purged`); } // plugin.json &quot;hooks&quot;: [ { &quot;hook&quot;: &quot;action:topic.purge&quot;, &quot;method&quot;: &quot;topicPurgeHandler&quot; }, ] &quot;action:topic.save&quot; Emitted when a new topic is being saved Source: nodebb_events.js, line 47 Listeners of This Event: backend.module:hashing.hashing.shortenTopic Example // listener function topicSaveHandler(topicData) { pluginMagic(topicData.title, topicData.tid, topicData.uid, function(err) { if(err) { return console.error(err); } console.debug(`User ID ${topicData.uid} just yanked ${topicData.title} out of a hat! Magic be magical!`); }); } // plugin.json &quot;hooks&quot;: [ { &quot;hook&quot;: &quot;action:topic.save&quot;, &quot;method&quot;: &quot;topicSaveHandler&quot; }, ] &quot;filter:admin.header.build&quot; Reports that NodeBB is ready to accept custom ACP menu items Properties: Name Type Description custom_header Object Properties Name Type Description plugins Array.&lt;Object&gt; Plugin menu entries; see example for structure cb function Expects to be called with updated custom_header object Source: nodebb_events.js, line 24 Listeners of This Event: backend.module:SmoothShorts.addMenuItem Example // listener function addMenuItem(custom_header, cb) { custom_header.plugins.push({ route: '/plugins/smoothshorts', // Path for menu entry, relative to /admin/ icon: 'fa-location-arrow', // Fontawesome class name for icon shown on menu entry (legacy! &lt;= NodeBB 0.7.x) name: 'SmoothShorts' // Text shown on menu entry }); cb(null, custom_header); }; // plugin.json &quot;hooks&quot;: [ { &quot;hook&quot;: &quot;filter:admin.header.build&quot;, &quot;method&quot;: &quot;addMenuItem&quot; } ] &quot;static:app.load&quot; Reports that NodeBB is in startup sequence. Used to initialise plugins Properties: Name Type Description app app Express app object for access to router, middlewares, etc. cb function Expects to be called with updated app object Source: nodebb_events.js, line 1 Listeners of This Event: backend.module:SmoothShorts.init Example // listener function init(app, cb) { app.router.get('/foo/:bar', app.middleware.handleRoute); try { couldFail(); } catch (err) { return cb(err); } cb(null, app); } // plugin.json &quot;hooks&quot;: [ { &quot;hook&quot;: &quot;static:app.load&quot;, &quot;method&quot;: &quot;init&quot; } ] × Search results Close Documentation generated by JSDoc 3.4.0 on 2016-04-22T06:55:56+02:00 using the DocStrap template. "},"classes.list.html":{"id":"classes.list.html","title":"Classes","body":" Documentation Namespaces acpacp.controllerbackendclientclient.controllernodebb-core Modules backend.hashingbackend.SmoothShortsclient.contextmenuclient.helperclient.settingsclient.sockets Classes client.HashedPostclient.HashedTopic Events nodebb-core.event:&quot;action:post.purge&quot;nodebb-core.event:&quot;action:post.save&quot;nodebb-core.event:&quot;action:topic.purge&quot;nodebb-core.event:&quot;action:topic.save&quot;nodebb-core.event:&quot;filter:admin.header.build&quot;nodebb-core.event:&quot;static:app.load&quot; Classes Classes HashedPost HashedTopic Namespaces acp controller backend client controller nodebb-core Events &quot;action:post.purge&quot; Emitted when a post is being purged (i.e. deleted from DB) Source: nodebb_events.js, line 101 Listeners of This Event: backend.module:hashing.hashing.purgePost Example // listener function postPurgeHandler(pid) { console.debug(`Post with id ${pid} has been deleted`); } // plugin.json &quot;hooks&quot;: [ { &quot;hook&quot;: &quot;action:post.purge&quot;, &quot;method&quot;: &quot;postPurgeHandler&quot; }, ] &quot;action:post.save&quot; Emitted when a new post is being saved Source: nodebb_events.js, line 81 Listeners of This Event: backend.module:hashing.hashing.shortenPost Example // listener function postSaveHandler(postData) { pluginMagic(postData.content, postData.pid, function(err) { if(err) { return console.error(err); } console.debug(`... and all the sudden ${postData.tid} has a post more. *poof*!`); }); } // plugin.json &quot;hooks&quot;: [ { &quot;hook&quot;: &quot;action:post.save&quot;, &quot;method&quot;: &quot;postSaveHandler&quot; }, ] &quot;action:topic.purge&quot; Emitted when a topic is being purged (i.e. deleted from DB) Source: nodebb_events.js, line 67 Listeners of This Event: backend.module:hashing.hashing.purgeTopic Example // listener function topicPurgeHandler(tid) { console.debug(`Topic with id ${tid} has been purged`); } // plugin.json &quot;hooks&quot;: [ { &quot;hook&quot;: &quot;action:topic.purge&quot;, &quot;method&quot;: &quot;topicPurgeHandler&quot; }, ] &quot;action:topic.save&quot; Emitted when a new topic is being saved Source: nodebb_events.js, line 47 Listeners of This Event: backend.module:hashing.hashing.shortenTopic Example // listener function topicSaveHandler(topicData) { pluginMagic(topicData.title, topicData.tid, topicData.uid, function(err) { if(err) { return console.error(err); } console.debug(`User ID ${topicData.uid} just yanked ${topicData.title} out of a hat! Magic be magical!`); }); } // plugin.json &quot;hooks&quot;: [ { &quot;hook&quot;: &quot;action:topic.save&quot;, &quot;method&quot;: &quot;topicSaveHandler&quot; }, ] &quot;filter:admin.header.build&quot; Reports that NodeBB is ready to accept custom ACP menu items Properties: Name Type Description custom_header Object Properties Name Type Description plugins Array.&lt;Object&gt; Plugin menu entries; see example for structure cb function Expects to be called with updated custom_header object Source: nodebb_events.js, line 24 Listeners of This Event: backend.module:SmoothShorts.addMenuItem Example // listener function addMenuItem(custom_header, cb) { custom_header.plugins.push({ route: '/plugins/smoothshorts', // Path for menu entry, relative to /admin/ icon: 'fa-location-arrow', // Fontawesome class name for icon shown on menu entry (legacy! &lt;= NodeBB 0.7.x) name: 'SmoothShorts' // Text shown on menu entry }); cb(null, custom_header); }; // plugin.json &quot;hooks&quot;: [ { &quot;hook&quot;: &quot;filter:admin.header.build&quot;, &quot;method&quot;: &quot;addMenuItem&quot; } ] &quot;static:app.load&quot; Reports that NodeBB is in startup sequence. Used to initialise plugins Properties: Name Type Description app app Express app object for access to router, middlewares, etc. cb function Expects to be called with updated app object Source: nodebb_events.js, line 1 Listeners of This Event: backend.module:SmoothShorts.init Example // listener function init(app, cb) { app.router.get('/foo/:bar', app.middleware.handleRoute); try { couldFail(); } catch (err) { return cb(err); } cb(null, app); } // plugin.json &quot;hooks&quot;: [ { &quot;hook&quot;: &quot;static:app.load&quot;, &quot;method&quot;: &quot;init&quot; } ] × Search results Close Documentation generated by JSDoc 3.4.0 on 2016-04-22T06:55:56+02:00 using the DocStrap template. "},"namespaces.list.html":{"id":"namespaces.list.html","title":"Namespaces","body":" Documentation Namespaces acpacp.controllerbackendclientclient.controllernodebb-core Modules backend.hashingbackend.SmoothShortsclient.contextmenuclient.helperclient.settingsclient.sockets Classes client.HashedPostclient.HashedTopic Events nodebb-core.event:&quot;action:post.purge&quot;nodebb-core.event:&quot;action:post.save&quot;nodebb-core.event:&quot;action:topic.purge&quot;nodebb-core.event:&quot;action:topic.save&quot;nodebb-core.event:&quot;filter:admin.header.build&quot;nodebb-core.event:&quot;static:app.load&quot; Namespaces Classes HashedPost HashedTopic Namespaces acp controller backend client controller nodebb-core Events &quot;action:post.purge&quot; Emitted when a post is being purged (i.e. deleted from DB) Source: nodebb_events.js, line 101 Listeners of This Event: backend.module:hashing.hashing.purgePost Example // listener function postPurgeHandler(pid) { console.debug(`Post with id ${pid} has been deleted`); } // plugin.json &quot;hooks&quot;: [ { &quot;hook&quot;: &quot;action:post.purge&quot;, &quot;method&quot;: &quot;postPurgeHandler&quot; }, ] &quot;action:post.save&quot; Emitted when a new post is being saved Source: nodebb_events.js, line 81 Listeners of This Event: backend.module:hashing.hashing.shortenPost Example // listener function postSaveHandler(postData) { pluginMagic(postData.content, postData.pid, function(err) { if(err) { return console.error(err); } console.debug(`... and all the sudden ${postData.tid} has a post more. *poof*!`); }); } // plugin.json &quot;hooks&quot;: [ { &quot;hook&quot;: &quot;action:post.save&quot;, &quot;method&quot;: &quot;postSaveHandler&quot; }, ] &quot;action:topic.purge&quot; Emitted when a topic is being purged (i.e. deleted from DB) Source: nodebb_events.js, line 67 Listeners of This Event: backend.module:hashing.hashing.purgeTopic Example // listener function topicPurgeHandler(tid) { console.debug(`Topic with id ${tid} has been purged`); } // plugin.json &quot;hooks&quot;: [ { &quot;hook&quot;: &quot;action:topic.purge&quot;, &quot;method&quot;: &quot;topicPurgeHandler&quot; }, ] &quot;action:topic.save&quot; Emitted when a new topic is being saved Source: nodebb_events.js, line 47 Listeners of This Event: backend.module:hashing.hashing.shortenTopic Example // listener function topicSaveHandler(topicData) { pluginMagic(topicData.title, topicData.tid, topicData.uid, function(err) { if(err) { return console.error(err); } console.debug(`User ID ${topicData.uid} just yanked ${topicData.title} out of a hat! Magic be magical!`); }); } // plugin.json &quot;hooks&quot;: [ { &quot;hook&quot;: &quot;action:topic.save&quot;, &quot;method&quot;: &quot;topicSaveHandler&quot; }, ] &quot;filter:admin.header.build&quot; Reports that NodeBB is ready to accept custom ACP menu items Properties: Name Type Description custom_header Object Properties Name Type Description plugins Array.&lt;Object&gt; Plugin menu entries; see example for structure cb function Expects to be called with updated custom_header object Source: nodebb_events.js, line 24 Listeners of This Event: backend.module:SmoothShorts.addMenuItem Example // listener function addMenuItem(custom_header, cb) { custom_header.plugins.push({ route: '/plugins/smoothshorts', // Path for menu entry, relative to /admin/ icon: 'fa-location-arrow', // Fontawesome class name for icon shown on menu entry (legacy! &lt;= NodeBB 0.7.x) name: 'SmoothShorts' // Text shown on menu entry }); cb(null, custom_header); }; // plugin.json &quot;hooks&quot;: [ { &quot;hook&quot;: &quot;filter:admin.header.build&quot;, &quot;method&quot;: &quot;addMenuItem&quot; } ] &quot;static:app.load&quot; Reports that NodeBB is in startup sequence. Used to initialise plugins Properties: Name Type Description app app Express app object for access to router, middlewares, etc. cb function Expects to be called with updated app object Source: nodebb_events.js, line 1 Listeners of This Event: backend.module:SmoothShorts.init Example // listener function init(app, cb) { app.router.get('/foo/:bar', app.middleware.handleRoute); try { couldFail(); } catch (err) { return cb(err); } cb(null, app); } // plugin.json &quot;hooks&quot;: [ { &quot;hook&quot;: &quot;static:app.load&quot;, &quot;method&quot;: &quot;init&quot; } ] × Search results Close Documentation generated by JSDoc 3.4.0 on 2016-04-22T06:55:56+02:00 using the DocStrap template. "},"index.html":{"id":"index.html","title":"Index","body":" Documentation Namespaces acpacp.controllerbackendclientclient.controllernodebb-core Modules backend.hashingbackend.SmoothShortsclient.contextmenuclient.helperclient.settingsclient.sockets Classes client.HashedPostclient.HashedTopic Events nodebb-core.event:&quot;action:post.purge&quot;nodebb-core.event:&quot;action:post.save&quot;nodebb-core.event:&quot;action:topic.purge&quot;nodebb-core.event:&quot;action:topic.save&quot;nodebb-core.event:&quot;filter:admin.header.build&quot;nodebb-core.event:&quot;static:app.load&quot; nodebb-plugin-smoothshorts 0.3.0 # nodebb-plugin-smoothshorts Seamless short URL plugin for NodeBBNobody likes itchy pants, do you? Neither do I. :smirk: That's why these shorts are seamlessly woven into the NodeBB experience, your users won't feel a thing. Installation Preferably, install SmoothShorts from the list of available plugins in your NodeBB ACP. Manual installation via npm install nodebb-plugin-smoothshorts is possible, but doesn't guarantee compatibility with your NodeBB version. Activate the plugin in ACP/Extend/Plugins. Setup plugin (and hash already existing posts/topics) in ACP/Plugins/SmoothShorts. Go click 'em! :D MethodsCopy ButtonGiven that the client's browser supports the execCommand('copy'), SmoothShorts will add an icon next to post links, which copies the short URL with a single click. The context menu method is always available. NOTE: If you are using NodeBB &gt;=1.0.0, you have a more suitable icon (.fa-hashtag) available. The plugin's default .fa-external-link ensures backwards compatibility. You can change the icon in the settings. Context MenuOnce a user opens the browser's context menu upon a topic link, the href value of that link gets replaced with its assigned hash: This also works on posts: (Not all themes have those links; same goes for teasers. Posts are hashed, regardless of used theme.) The now copied address is of the form https://yourNodeBB.org/ss/:hash (default, see URL Format). Visiting it will redirect to the associated post or topic: Settings (ACP/Plugins/SmoothShorts)###- Modifier key Users would have to press Ctrl/Alt/Shift while opening the context menu to replace the link. ###- URL Format Define the format of your short URLs! Use :hash as a placeholder for topic/post hashes. (e.g. short.com/ss/:hash, short.com/:hash, short.com/:hash/yolo) NOTE: Changing the URL format requires a NodeBB restart to apply the route hashes are accepted on. ###- Copy Button Pick the icon for the copy button from the fontawesome icon set. Q/A &amp; Known Issues###Why not use a service like bit.ly or goo.gl? Coming in 0.4.0!For two reasons: 1. While investigating bit.ly, I noticed that they impose limits on calls to their API. No need to hate them for it; in fact, they have every right to do so, protecting themselves against bots and such. But unfortunately, as hashing is triggered by every user creating a topic/post, a single spam attack on your NodeBB could make you run out of those API calls; just like that. 2. Links to posts in NodeBB are not structured like /topic/topicslug/postID, but rather /topic/topicslug/positionInTopic. Which means that if you purge a post, your already created short urls would get all mixed up. × Search results Close Documentation generated by JSDoc 3.4.0 on 2016-04-22T06:55:56+02:00 using the DocStrap template. "},"acp.html":{"id":"acp.html","title":"Namespace: acp","body":" Documentation Namespaces acpacp.controllerbackendclientclient.controllernodebb-core Modules backend.hashingbackend.SmoothShortsclient.contextmenuclient.helperclient.settingsclient.sockets Classes client.HashedPostclient.HashedTopic Events nodebb-core.event:&quot;action:post.purge&quot;nodebb-core.event:&quot;action:post.save&quot;nodebb-core.event:&quot;action:topic.purge&quot;nodebb-core.event:&quot;action:topic.save&quot;nodebb-core.event:&quot;filter:admin.header.build&quot;nodebb-core.event:&quot;static:app.load&quot; Namespace: acp acp Frontend ACP scripts Source: virtual_namespaces.js, line 5 Namespaces controller × Search results Close Documentation generated by JSDoc 3.4.0 on 2016-04-22T06:55:56+02:00 using the DocStrap template. "},"acp.controller.html":{"id":"acp.controller.html","title":"Namespace: controller","body":" Documentation Namespaces acpacp.controllerbackendclientclient.controllernodebb-core Modules backend.hashingbackend.SmoothShortsclient.contextmenuclient.helperclient.settingsclient.sockets Classes client.HashedPostclient.HashedTopic Events nodebb-core.event:&quot;action:post.purge&quot;nodebb-core.event:&quot;action:post.save&quot;nodebb-core.event:&quot;action:topic.purge&quot;nodebb-core.event:&quot;action:topic.save&quot;nodebb-core.event:&quot;filter:admin.header.build&quot;nodebb-core.event:&quot;static:app.load&quot; Namespace: controller acp. controller Source: public/static/scripts/controller.js, line 6 Members &lt;static&gt; $shortFormat :jQuery JQuery instance of shortFormat Type: jQuery Source: public/static/scripts/controller.js, line 35 &lt;static&gt; btnHash :HTMLButtonElement Button to trigger hashing of unhashed posts/topics Type: HTMLButtonElement Source: public/static/scripts/controller.js, line 48 &lt;static&gt; btnSave :HTMLButtonElement Button to save settings Type: HTMLButtonElement Source: public/static/scripts/controller.js, line 54 &lt;static&gt; copyButtonIcon :HTMLButtonElement Button to select icon for copy button Type: HTMLButtonElement Source: public/static/scripts/controller.js, line 42 &lt;static&gt; counter :Object Holds Elements for 'status' (i.e. # of hashed/unhased topics and posts) Type: Object Properties: Name Type Description topicTotal HTMLDivElement Shows total # of topics topic HTMLDivElement Shows # of hashed topics topicWell HTMLDivElement Wraps topicTotal and topic; indicates missing hashes with red border-left/right postTotal HTMLDivElement Shows total # of posts post HTMLDivElement Shows # of hashed posts postWell HTMLDivElement Wraps postsTotal and post; indicates missing hashes with red border-left/right Source: public/static/scripts/controller.js, line 67 &lt;static&gt; ddModKey :HTMLSelectElement Dropdown selection Element to set (possible) modifier key Type: HTMLSelectElement Source: public/static/scripts/controller.js, line 23 See: acp.controller.useModKey &lt;static&gt; shortFormat :HTMLInputElement Text input Element to define short URL format Type: HTMLInputElement Source: public/static/scripts/controller.js, line 29 &lt;static&gt; useModKey :HTMLInputElement Checkbox Element, indicating whether to use set modifier key Type: HTMLInputElement Source: public/static/scripts/controller.js, line 16 Methods &lt;inner&gt; handleNewHash(data) Updates acp.controller.counter Elements on newhash-message from backend Parameters: Name Type Description data Object Source: public/static/scripts/controller.js, line 153 &lt;inner&gt; handleUseModKey(event) Disables/Enables ddModKey Parameters: Name Type Description event MouseEvent Source: public/static/scripts/controller.js, line 76 &lt;inner&gt; hashMissing() Starts hashing unhashed topics/posts Source: public/static/scripts/controller.js, line 122 &lt;inner&gt; saveSettings(event) Saves settings Parameters: Name Type Description event MouseEvent Source: public/static/scripts/controller.js, line 87 &lt;inner&gt; selectIcon(event) Invokes module:iconSelect (NodeBB core) to change copy button's icon Parameters: Name Type Description event MouseEvent Source: public/static/scripts/controller.js, line 196 × Search results Close Documentation generated by JSDoc 3.4.0 on 2016-04-22T06:55:56+02:00 using the DocStrap template. "},"backend.html":{"id":"backend.html","title":"Namespace: backend","body":" Documentation Namespaces acpacp.controllerbackendclientclient.controllernodebb-core Modules backend.hashingbackend.SmoothShortsclient.contextmenuclient.helperclient.settingsclient.sockets Classes client.HashedPostclient.HashedTopic Events nodebb-core.event:&quot;action:post.purge&quot;nodebb-core.event:&quot;action:post.save&quot;nodebb-core.event:&quot;action:topic.purge&quot;nodebb-core.event:&quot;action:topic.save&quot;nodebb-core.event:&quot;filter:admin.header.build&quot;nodebb-core.event:&quot;static:app.load&quot; Namespace: backend backend Backend scripts Source: virtual_namespaces.js, line 1 × Search results Close Documentation generated by JSDoc 3.4.0 on 2016-04-22T06:55:56+02:00 using the DocStrap template. "},"backend.module_hashing.html":{"id":"backend.module_hashing.html","title":"Module: hashing","body":" Documentation Namespaces acpacp.controllerbackendclientclient.controllernodebb-core Modules backend.hashingbackend.SmoothShortsclient.contextmenuclient.helperclient.settingsclient.sockets Classes client.HashedPostclient.HashedTopic Events nodebb-core.event:&quot;action:post.purge&quot;nodebb-core.event:&quot;action:post.save&quot;nodebb-core.event:&quot;action:topic.purge&quot;nodebb-core.event:&quot;action:topic.save&quot;nodebb-core.event:&quot;filter:admin.header.build&quot;nodebb-core.event:&quot;static:app.load&quot; Module: hashing Provides methods for internal URL shortening and request resolving Source: lib/hashing.js, line 9 Members &lt;inner&gt; hashType :Object Maps 'topics'/'posts' to id key Type: Object Properties: Name Type Description topics string 'tid' posts string 'pid' Source: lib/hashing.js, line 26 To Do: This was once an array. Deserves to be deprecated, since something like `(topics|posts).substr(0, 1) + 'id'` would be sufficient Methods &lt;static&gt; hashing.purgePost(id) Purge post event handler Parameters: Name Type Description id number Source: lib/hashing.js, line 83 Listens to Events: nodebb-core.event:&quot;action:post.purge&quot; &lt;static&gt; hashing.purgeTopic(id) Purge topic event handler Parameters: Name Type Description id number Source: lib/hashing.js, line 93 Listens to Events: nodebb-core.event:&quot;action:topic.purge&quot; &lt;static&gt; hashing.resolveHash(req, res, cb) Resolves a short URL request and redirects to associated topic/post Parameters: Name Type Description req request Express request instance res response Express response instance cb function Source: lib/hashing.js, line 104 &lt;static&gt; hashing.shortenPost(postData, cb) New post event handler Parameters: Name Type Description postData Object cb function Source: lib/hashing.js, line 62 Listens to Events: nodebb-core.event:&quot;action:post.save&quot; &lt;static&gt; hashing.shortenTopic(topicData, cb) New topic event handler Parameters: Name Type Description topicData Object cb function Source: lib/hashing.js, line 73 Listens to Events: nodebb-core.event:&quot;action:topic.save&quot; &lt;inner&gt; hashData(data) Creates hashes for short URLs Parameters: Name Type Description data topicData | postData Source: lib/hashing.js, line 230 &lt;inner&gt; purge(id, type) Deletes hashes from DB Parameters: Name Type Description id number type string hashType key Source: lib/hashing.js, line 214 &lt;inner&gt; shorten(data, type, cb) Stores new hashes in DB Parameters: Name Type Description data topicData | postdata type string hashType key cb function Source: lib/hashing.js, line 191 × Search results Close Documentation generated by JSDoc 3.4.0 on 2016-04-22T06:55:56+02:00 using the DocStrap template. "},"backend.module_SmoothShorts.html":{"id":"backend.module_SmoothShorts.html","title":"Module: SmoothShorts","body":" Documentation Namespaces acpacp.controllerbackendclientclient.controllernodebb-core Modules backend.hashingbackend.SmoothShortsclient.contextmenuclient.helperclient.settingsclient.sockets Classes client.HashedPostclient.HashedTopic Events nodebb-core.event:&quot;action:post.purge&quot;nodebb-core.event:&quot;action:post.save&quot;nodebb-core.event:&quot;action:topic.purge&quot;nodebb-core.event:&quot;action:topic.save&quot;nodebb-core.event:&quot;filter:admin.header.build&quot;nodebb-core.event:&quot;static:app.load&quot; Module: SmoothShorts SmoothShorts - Seamless short URLs for NodeBB Author: Raphael Beer License: MIT Source: lib/controller.js, line 14 Requires module:backend.module:hashing module:backend.module:settings module:backend.module:sockets Methods &lt;static&gt; addMenuItem(custom_header, cb) Adds menu entry to ACP/Plugins Parameters: Name Type Description custom_header Object See event for structure details cb function Source: lib/controller.js, line 53 Listens to Events: nodebb-core.event:&quot;filter:admin.header.build&quot; &lt;static&gt; init(app, cb) Plugin initialisation Parameters: Name Type Description app app Express app instance cb function Source: lib/controller.js, line 34 Listens to Events: nodebb-core.event:&quot;static:app.load&quot; &lt;static&gt; openSockets() Registers socket.io methods Source: lib/controller.js, line 74 &lt;static&gt; setRoutes(router, middleware) Registers Express routes Parameters: Name Type Description router router NodeBB's Express plugin router middleware Object.&lt;string, middleware&gt; NodeBB's Express middlewares Source: lib/controller.js, line 85 × Search results Close Documentation generated by JSDoc 3.4.0 on 2016-04-22T06:55:56+02:00 using the DocStrap template. "},"client.html":{"id":"client.html","title":"Namespace: client","body":" Documentation Namespaces acpacp.controllerbackendclientclient.controllernodebb-core Modules backend.hashingbackend.SmoothShortsclient.contextmenuclient.helperclient.settingsclient.sockets Classes client.HashedPostclient.HashedTopic Events nodebb-core.event:&quot;action:post.purge&quot;nodebb-core.event:&quot;action:post.save&quot;nodebb-core.event:&quot;action:topic.purge&quot;nodebb-core.event:&quot;action:topic.save&quot;nodebb-core.event:&quot;filter:admin.header.build&quot;nodebb-core.event:&quot;static:app.load&quot; Namespace: client client Frontend client scripts Source: virtual_namespaces.js, line 9 Classes HashedPost HashedTopic Namespaces controller × Search results Close Documentation generated by JSDoc 3.4.0 on 2016-04-22T06:55:56+02:00 using the DocStrap template. "},"client.controller.html":{"id":"client.controller.html","title":"Namespace: controller","body":" Documentation Namespaces acpacp.controllerbackendclientclient.controllernodebb-core Modules backend.hashingbackend.SmoothShortsclient.contextmenuclient.helperclient.settingsclient.sockets Classes client.HashedPostclient.HashedTopic Events nodebb-core.event:&quot;action:post.purge&quot;nodebb-core.event:&quot;action:post.save&quot;nodebb-core.event:&quot;action:topic.purge&quot;nodebb-core.event:&quot;action:topic.save&quot;nodebb-core.event:&quot;filter:admin.header.build&quot;nodebb-core.event:&quot;static:app.load&quot; Namespace: controller client. controller Source: public/scripts/controller.js, line 17 Methods &lt;inner&gt; addHashes(type, hashedObjects) Adds from backend received hashes to topic and post links Parameters: Name Type Description type client.controller~hashedType hashedObjects Array.&lt;(client.HashedPost|client.HashedTopic)&gt; Objects to add hashes for Source: public/scripts/controller.js, line 153 &lt;inner&gt; addOnScrollLoad(event, data) Parses incoming controller~AjaxifyData when user scrolling triggers loading new entries Parameters: Name Type Description event SomeJQueryEventObject data client.controller~AjaxifyData Source: public/scripts/controller.js, line 141 &lt;inner&gt; copyShortUrl() One-click button click handler Source: public/scripts/controller.js, line 169 &lt;inner&gt; ensureTeaserPids(pageData) Ensures that teaser objects have a pid. Parameters: Name Type Description pageData client.controller~AjaxifyData Source: public/scripts/controller.js, line 101 &lt;inner&gt; init() Entry point; sets hooks Source: public/scripts/controller.js, line 196 &lt;inner&gt; parseAjaxifyData() Parses AjaxifyData for posts/categories/topics Source: public/scripts/controller.js, line 79 &lt;inner&gt; teasersHavePids(pageData) Checks whether current pages teaser objects have pids Parameters: Name Type Description pageData client.controller~AjaxifyData Source: public/scripts/controller.js, line 120 Returns: Result of an [].some() run. If one teaser has a pid, all do. Type bool Type Definitions AjaxifyData NodeBB's ajaxify.data object (showing only properties plugin is working with) Type: Object Properties: Name Type Argument Description categories Array.&lt;client.controller~CategoryData&gt; &lt;nullable&gt; posts Array.&lt;client.controller~PostData&gt; &lt;nullable&gt; topics Array.&lt;client.controller~TopicData&gt; &lt;nullable&gt; Source: public/scripts/controller.js, line 22 CategoryData Ajaxify data, describing a category (showing only properties plugin is working with) Type: Object Properties: Name Type Description posts Array.&lt;client.controller~PostData&gt; First entry is the teaser post. client.controller~ensureTeaserPids uses it, when teaser object has no pid. teaser client.controller~TeaserData Source: public/scripts/controller.js, line 39 hashedType Type identifier for HashedPost or HashedTopic Type: string Source: public/scripts/controller.js, line 67 Example 'topics' or 'posts' PostData Ajaxify data, describing a post (showing only properties plugin is working with) Type: Object Properties: Name Type Description topic client.controller~TopicData Topic the post belongs to index number Index of post in topic pid string Post's ID Source: public/scripts/controller.js, line 58 TeaserData Ajaxify data, describing a teaser (showing only properties plugin is working with) Type: Object Properties: Name Type Argument Description pid string &lt;nullable&gt; Introduced in NodeBB v1.0.3; earlier versions need to get it with client.controller~ensureTeaserPids url string URL to post Source: public/scripts/controller.js, line 31 TopicData Ajaxify data, describing a topic (showing only properties plugin is working with) Type: Object Properties: Name Type Argument Description slug string Topic's URL slug tid string Topic's ID postcount string Total number of posts in topic title string Topic's title teaser client.controller~TeaserData &lt;nullable&gt; Topic's teaser Source: public/scripts/controller.js, line 47 × Search results Close Documentation generated by JSDoc 3.4.0 on 2016-04-22T06:55:56+02:00 using the DocStrap template. "},"client.HashedPost.html":{"id":"client.HashedPost.html","title":"Class: HashedPost","body":" Documentation Namespaces acpacp.controllerbackendclientclient.controllernodebb-core Modules backend.hashingbackend.SmoothShortsclient.contextmenuclient.helperclient.settingsclient.sockets Classes client.HashedPostclient.HashedTopic Events nodebb-core.event:&quot;action:post.purge&quot;nodebb-core.event:&quot;action:post.save&quot;nodebb-core.event:&quot;action:topic.purge&quot;nodebb-core.event:&quot;action:topic.save&quot;nodebb-core.event:&quot;filter:admin.header.build&quot;nodebb-core.event:&quot;static:app.load&quot; Class: HashedPost client. HashedPost new HashedPost(data) Represents a shortened post URL. This URL can belong to multiple HTMLAnchorElements in the DOM. Parameters: Name Type Description data Object Properties Name Type Argument Description pid string url string &lt;nullable&gt; index number &lt;nullable&gt; topicData Object Properties Name Type Argument Description title string slug string &lt;nullable&gt; Source: public/scripts/hashed/post.js, line 25 Members anchors :Array.&lt;HTMLAnchorElement&gt; Anchor elements using post's URL Type: Array.&lt;HTMLAnchorElement&gt; Source: public/scripts/hashed/post.js, line 50 button :HTMLDivElement smoothshorts/copybutton component Type: HTMLDivElement Source: public/scripts/hashed/post.js, line 62 hash :string Hash used for this post's short URL Type: string Source: public/scripts/hashed/post.js, line 56 index :number Index of post in its topic Type: number Source: public/scripts/hashed/post.js, line 44 pid :number Post's ID Type: number Source: public/scripts/hashed/post.js, line 38 shortUrlContainer :HTMLInputElement Text input element to copy short URL from Type: HTMLInputElement Source: public/scripts/hashed/post.js, line 68 url :string Posts's URL Type: string Source: public/scripts/hashed/post.js, line 32 Methods &lt;inner&gt; getAnchors(url, topicTitle) Collects anchor elements from DOM and stores them in instances anchors Parameters: Name Type Description url string URL to find anchors topicTitle string Title of post's topic to filter topic links Source: public/scripts/hashed/post.js, line 144 To Do: Extract superclass - DRY with client.HashedTopic~getAnchors × Search results Close Documentation generated by JSDoc 3.4.0 on 2016-04-22T06:55:56+02:00 using the DocStrap template. "},"client.HashedTopic.html":{"id":"client.HashedTopic.html","title":"Class: HashedTopic","body":" Documentation Namespaces acpacp.controllerbackendclientclient.controllernodebb-core Modules backend.hashingbackend.SmoothShortsclient.contextmenuclient.helperclient.settingsclient.sockets Classes client.HashedPostclient.HashedTopic Events nodebb-core.event:&quot;action:post.purge&quot;nodebb-core.event:&quot;action:post.save&quot;nodebb-core.event:&quot;action:topic.purge&quot;nodebb-core.event:&quot;action:topic.save&quot;nodebb-core.event:&quot;filter:admin.header.build&quot;nodebb-core.event:&quot;static:app.load&quot; Class: HashedTopic client. HashedTopic new HashedTopic(data) Represents a shortened topic URL. This URL can belong to multiple HTMLAnchorElements in the DOM. Parameters: Name Type Description data Object Properties Name Type Description slug string tid string postcount string title string Source: public/scripts/hashed/topic.js, line 16 Members anchors :Array.&lt;HTMLAnchorElement&gt; Anchor elements using topic's URL Type: Array.&lt;HTMLAnchorElement&gt; Source: public/scripts/hashed/topic.js, line 34 hash :string Hash used for this topic's short URL Type: string Source: public/scripts/hashed/topic.js, line 40 tid :number Topic's ID Type: number Source: public/scripts/hashed/topic.js, line 28 url :string Topic's URL Type: string Source: public/scripts/hashed/topic.js, line 22 Methods &lt;inner&gt; getAnchors(url, postcount, title) Collects anchor elements from DOM and stores them in instances anchors Parameters: Name Type Description url string URL to find anchors postcount string Topic's postcount to filter out something - forgot what, though; might even be deprecated... ^_^ title string Topic's title to filter out false selector positives Source: public/scripts/hashed/topic.js, line 68 To Do: Extract superclass - DRY with client.HashedPost~getAnchors × Search results Close Documentation generated by JSDoc 3.4.0 on 2016-04-22T06:55:57+02:00 using the DocStrap template. "},"client.module_contextmenu.html":{"id":"client.module_contextmenu.html","title":"Module: contextmenu","body":" Documentation Namespaces acpacp.controllerbackendclientclient.controllernodebb-core Modules backend.hashingbackend.SmoothShortsclient.contextmenuclient.helperclient.settingsclient.sockets Classes client.HashedPostclient.HashedTopic Events nodebb-core.event:&quot;action:post.purge&quot;nodebb-core.event:&quot;action:post.save&quot;nodebb-core.event:&quot;action:topic.purge&quot;nodebb-core.event:&quot;action:topic.save&quot;nodebb-core.event:&quot;filter:admin.header.build&quot;nodebb-core.event:&quot;static:app.load&quot; Module: contextmenu Provides context menu method Source: public/scripts/contextmenu.js, line 10 Members &lt;static&gt; lastCalledOn :HTMLAnchorElement Element context menu has been called on Type: HTMLAnchorElement Default Value: null Source: public/scripts/contextmenu.js, line 33 &lt;static&gt; lastOriginalURL :String href value to restore on lastCalledOn Type: String Source: public/scripts/contextmenu.js, line 39 &lt;static&gt; menuCalled :Boolean Indicates whether context menu is open Type: Boolean Default Value: false Source: public/scripts/contextmenu.js, line 26 Methods &lt;static&gt; cmenu.setHooks(HashedObject) Sets hooks 'contextmenu' on given HashedPost|HashedTopic's anchors and 'mousedown' on document. Parameters: Name Type Description HashedObject HashedPost | HashedTopic Source: public/scripts/contextmenu.js, line 48 &lt;inner&gt; replaceWithShortURL(event) Replaces href of an anchor with short URL. Parameters: Name Type Description event MouseEvent Source: public/scripts/contextmenu.js, line 76 &lt;inner&gt; restoreOriginalURL() Restores lastOriginalURL on lastCalledOn Source: public/scripts/contextmenu.js, line 61 × Search results Close Documentation generated by JSDoc 3.4.0 on 2016-04-22T06:55:57+02:00 using the DocStrap template. "},"client.module_helper.html":{"id":"client.module_helper.html","title":"Module: helper","body":" Documentation Namespaces acpacp.controllerbackendclientclient.controllernodebb-core Modules backend.hashingbackend.SmoothShortsclient.contextmenuclient.helperclient.settingsclient.sockets Classes client.HashedPostclient.HashedTopic Events nodebb-core.event:&quot;action:post.purge&quot;nodebb-core.event:&quot;action:post.save&quot;nodebb-core.event:&quot;action:topic.purge&quot;nodebb-core.event:&quot;action:topic.save&quot;nodebb-core.event:&quot;filter:admin.header.build&quot;nodebb-core.event:&quot;static:app.load&quot; Module: helper Provides helper functions (for e.g. [].map, [].filter) Source: public/scripts/helper.js, line 4 Methods &lt;static&gt; helper.ArrayFromNodeList(nodeList) Polyfill for Array.from Parameters: Name Type Description nodeList NodeList List of HTMLElements Source: public/scripts/helper.js, line 21 Returns: Type Array &lt;static&gt; helper.buildShortURL(hash) Builds short URL from hash, using shortFormat Parameters: Name Type Description hash client.HashedPost#hash | client.HashedTopic#hash Source: public/scripts/helper.js, line 107 Returns: Type string &lt;static&gt; helper.postsMap(post, HashedPost) Maps PostData into HashedPost objects Parameters: Name Type Description post client.controller~PostData HashedPost client.HashedPost NOT an instance! Source: public/scripts/helper.js, line 56 Returns: New HashedPost instance Type client.HashedPost &lt;static&gt; helper.teaserFilter(obj) Filters TopicData or CategoryData objects without TeaserData member Parameters: Name Type Description obj client.controller~TopicData | client.controller~CategoryData [description] Source: public/scripts/helper.js, line 96 Returns: Type bool &lt;static&gt; helper.teaserMap(topic, HashedPost) Maps TeaserData into HashedPost objects Parameters: Name Type Description topic client.controller~TeaserData HashedPost client.HashedPost NOT an instance! Source: public/scripts/helper.js, line 78 Returns: New HashedPost instance Type client.HashedPost &lt;static&gt; helper.topicsMap(topic, HashedTopic) Maps TopicData into HashedTopic objects Parameters: Name Type Description topic client.controller~TopicData HashedTopic client.HashedTopic NOT an instance! Source: public/scripts/helper.js, line 40 Returns: New HashedTopic instance Type client.HashedTopic × Search results Close Documentation generated by JSDoc 3.4.0 on 2016-04-22T06:55:57+02:00 using the DocStrap template. "},"client.module_settings.html":{"id":"client.module_settings.html","title":"Module: settings","body":" Documentation Namespaces acpacp.controllerbackendclientclient.controllernodebb-core Modules backend.hashingbackend.SmoothShortsclient.contextmenuclient.helperclient.settingsclient.sockets Classes client.HashedPostclient.HashedTopic Events nodebb-core.event:&quot;action:post.purge&quot;nodebb-core.event:&quot;action:post.save&quot;nodebb-core.event:&quot;action:topic.purge&quot;nodebb-core.event:&quot;action:topic.save&quot;nodebb-core.event:&quot;filter:admin.header.build&quot;nodebb-core.event:&quot;static:app.load&quot; Module: settings Provides plugin's settings Source: public/scripts/settings.js, line 3 Members &lt;static&gt; copyButtonClass :String CSS class name for copy button icon Type: String Default Value: fa-external-link Source: public/scripts/settings.js, line 35 &lt;static&gt; modKey :string Modifier key (ctrl, alt or shift) to enable URL replacement Type: string Source: public/scripts/settings.js, line 18 &lt;static&gt; shortFormat :string Short URLs will be built with this format Type: string Source: public/scripts/settings.js, line 28 Example 'short.com/ss/:hash' 'short.com/:hash' 'short.com/:hash/yolo' Methods &lt;static&gt; settings.load(cb) Load settings from backend Parameters: Name Type Description cb function Called when settings have been received Source: public/scripts/settings.js, line 43 × Search results Close Documentation generated by JSDoc 3.4.0 on 2016-04-22T06:55:57+02:00 using the DocStrap template. "},"client.module_sockets.html":{"id":"client.module_sockets.html","title":"Module: sockets","body":" Documentation Namespaces acpacp.controllerbackendclientclient.controllernodebb-core Modules backend.hashingbackend.SmoothShortsclient.contextmenuclient.helperclient.settingsclient.sockets Classes client.HashedPostclient.HashedTopic Events nodebb-core.event:&quot;action:post.purge&quot;nodebb-core.event:&quot;action:post.save&quot;nodebb-core.event:&quot;action:topic.purge&quot;nodebb-core.event:&quot;action:topic.save&quot;nodebb-core.event:&quot;filter:admin.header.build&quot;nodebb-core.event:&quot;static:app.load&quot; Module: sockets Provides socket.io connections to backend Source: public/scripts/sockets.js, line 3 Methods &lt;static&gt; sockets.getHashes(type, hashedObjects, cb) Requests hashes Parameters: Name Type Description type client.controller~hashedType hashedObjects Array.&lt;(client.HashedPost|client.HashedTopic)&gt; Objects to get hashes for cb client.controller~addHashes Source: public/scripts/sockets.js, line 21 × Search results Close Documentation generated by JSDoc 3.4.0 on 2016-04-22T06:55:57+02:00 using the DocStrap template. "},"nodebb-core.html":{"id":"nodebb-core.html","title":"Namespace: nodebb-core","body":" Documentation Namespaces acpacp.controllerbackendclientclient.controllernodebb-core Modules backend.hashingbackend.SmoothShortsclient.contextmenuclient.helperclient.settingsclient.sockets Classes client.HashedPostclient.HashedTopic Events nodebb-core.event:&quot;action:post.purge&quot;nodebb-core.event:&quot;action:post.save&quot;nodebb-core.event:&quot;action:topic.purge&quot;nodebb-core.event:&quot;action:topic.save&quot;nodebb-core.event:&quot;filter:admin.header.build&quot;nodebb-core.event:&quot;static:app.load&quot; Namespace: nodebb-core nodebb-core NodeBB core parts, used in the plugin Source: virtual_namespaces.js, line 13 Events &quot;action:post.purge&quot; Emitted when a post is being purged (i.e. deleted from DB) Source: nodebb_events.js, line 101 Listeners of This Event: backend.module:hashing.hashing.purgePost Example // listener function postPurgeHandler(pid) { console.debug(`Post with id ${pid} has been deleted`); } // plugin.json &quot;hooks&quot;: [ { &quot;hook&quot;: &quot;action:post.purge&quot;, &quot;method&quot;: &quot;postPurgeHandler&quot; }, ] &quot;action:post.save&quot; Emitted when a new post is being saved Source: nodebb_events.js, line 81 Listeners of This Event: backend.module:hashing.hashing.shortenPost Example // listener function postSaveHandler(postData) { pluginMagic(postData.content, postData.pid, function(err) { if(err) { return console.error(err); } console.debug(`... and all the sudden ${postData.tid} has a post more. *poof*!`); }); } // plugin.json &quot;hooks&quot;: [ { &quot;hook&quot;: &quot;action:post.save&quot;, &quot;method&quot;: &quot;postSaveHandler&quot; }, ] &quot;action:topic.purge&quot; Emitted when a topic is being purged (i.e. deleted from DB) Source: nodebb_events.js, line 67 Listeners of This Event: backend.module:hashing.hashing.purgeTopic Example // listener function topicPurgeHandler(tid) { console.debug(`Topic with id ${tid} has been purged`); } // plugin.json &quot;hooks&quot;: [ { &quot;hook&quot;: &quot;action:topic.purge&quot;, &quot;method&quot;: &quot;topicPurgeHandler&quot; }, ] &quot;action:topic.save&quot; Emitted when a new topic is being saved Source: nodebb_events.js, line 47 Listeners of This Event: backend.module:hashing.hashing.shortenTopic Example // listener function topicSaveHandler(topicData) { pluginMagic(topicData.title, topicData.tid, topicData.uid, function(err) { if(err) { return console.error(err); } console.debug(`User ID ${topicData.uid} just yanked ${topicData.title} out of a hat! Magic be magical!`); }); } // plugin.json &quot;hooks&quot;: [ { &quot;hook&quot;: &quot;action:topic.save&quot;, &quot;method&quot;: &quot;topicSaveHandler&quot; }, ] &quot;filter:admin.header.build&quot; Reports that NodeBB is ready to accept custom ACP menu items Properties: Name Type Description custom_header Object Properties Name Type Description plugins Array.&lt;Object&gt; Plugin menu entries; see example for structure cb function Expects to be called with updated custom_header object Source: nodebb_events.js, line 24 Listeners of This Event: backend.module:SmoothShorts.addMenuItem Example // listener function addMenuItem(custom_header, cb) { custom_header.plugins.push({ route: '/plugins/smoothshorts', // Path for menu entry, relative to /admin/ icon: 'fa-location-arrow', // Fontawesome class name for icon shown on menu entry (legacy! &lt;= NodeBB 0.7.x) name: 'SmoothShorts' // Text shown on menu entry }); cb(null, custom_header); }; // plugin.json &quot;hooks&quot;: [ { &quot;hook&quot;: &quot;filter:admin.header.build&quot;, &quot;method&quot;: &quot;addMenuItem&quot; } ] &quot;static:app.load&quot; Reports that NodeBB is in startup sequence. Used to initialise plugins Properties: Name Type Description app app Express app object for access to router, middlewares, etc. cb function Expects to be called with updated app object Source: nodebb_events.js, line 1 Listeners of This Event: backend.module:SmoothShorts.init Example // listener function init(app, cb) { app.router.get('/foo/:bar', app.middleware.handleRoute); try { couldFail(); } catch (err) { return cb(err); } cb(null, app); } // plugin.json &quot;hooks&quot;: [ { &quot;hook&quot;: &quot;static:app.load&quot;, &quot;method&quot;: &quot;init&quot; } ] × Search results Close Documentation generated by JSDoc 3.4.0 on 2016-04-22T06:55:57+02:00 using the DocStrap template. "}}
    </script>

    <script type="text/javascript">
        $(document).ready(function() {
            Searcher.init();
        });

        $(window).on("message", function(msg) {
            var msgData = msg.originalEvent.data;

            if (msgData.msgid != "docstrap.quicksearch.start") {
                return;
            }

            var results = Searcher.search(msgData.searchTerms);

            window.parent.postMessage({"results": results, "msgid": "docstrap.quicksearch.done"}, "*");
        });
    </script>
</body>
</html>
